<%- include('./include/dashboardhead.ejs') -%>

    <div class="content-wrapper">
        <!-- Content -->

        <div class="container-xxl flex-grow-1 container-p-y">

          <div class="row">

            <div class="col-4 mb-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between flex-sm-row flex-column gap-1">
                      <div class="d-flex flex-sm-column flex-row align-items-start justify-content-between">
                        <div class="card-title">
                            <span class="badge bg-label-warning rounded-pill">Arrived 2021</span> <br>
                            <span class="badge bg-label-info rounded-pill">Storage : 2300 kg </span><br>
                            <span class="badge bg-label-danger rounded-pill">Billed : 1000 kg </span><br>
                            <span class="badge bg-label-success rounded-pill"> Commitment: 100000S </span>

                          
                        </div>
                     
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4 mb-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between flex-sm-row flex-column gap-3">
                      <div class="d-flex flex-sm-column flex-row align-items-start justify-content-between">
                        <div class="card-title">
                       
                          <span class="badge bg-label-warning rounded-pill">Dispatched 2021</span> <br>
                          <span class="badge bg-label-info rounded-pill">Storage : 2300 kg </span><br>
                          <span class="badge bg-label-danger rounded-pill">Billed : 1000 kg </span><br>
                          <span class="badge bg-label-success rounded-pill">Commitment : 100000S </span>
                        </div>
                       
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4 mb-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between flex-sm-row flex-column gap-2">
                      <div class="d-flex flex-sm-column flex-row align-items-start justify-content-between">
                        <div class="card-title">
                          <span class="badge bg-label-warning rounded-pill">Recievable : 2021 </span> <br>
                          <span class="badge bg-label-info rounded-pill">Payable : 2300 kg </span><br>
                          <span class="badge bg-label-danger rounded-pill">Credit : 1000 kg </span><br>
                          <span class="badge bg-label-success rounded-pill">Debit : 100000S </span> <br>

                        </div>
                     
                      </div>
                    </div>
                  </div>
                </div>
              </div>  
          
            </div>
            <div class="row justify-content-between"> 
              <div class="col-6" id="heading"><h3>midlaj</h3> </div>
              <div class="col-3"> <h3 style="color: black;font-weight: bold;">Balance RS : 300000</h3></button>

</div>
             
            </div>
            <!-- Basic Bootstrap Table -->
            <div class="card">
              <div class="card-body">
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Purchase Bills</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Sales Bills</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Arrival</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Despatch</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Store-In</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Store-Out</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Purchase Commitments</a>
                <a class="btn btn-primary text-white" href="#" onclick="openAddModal()" data-bs-toggle="modal" data-bs-target="#modalCenter">Sales Commitments</a>

                <div class="table-responsive text-nowrap p-4">
                    <table class="table" id="example">
                        <thead>
                            <tr>
                              <th>Property Id</th>
                                <th>Property Name</th>
                                <th>Property</th>
                                <th>Listed for</th>
                                <th>Location</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody class="table-border-bottom-0" id="table-body">
                          <!-- Data will be populated here -->
                      </tbody>
  </table>

</div>
</div>
</div>
<!--/ Basic Bootstrap Table -->

</div>
<!-- / Content -->

<!-- Footer -->

<!-- / Footer -->

<div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->
</div>
<!-- / Layout page -->
</div>

<!-- Overlay -->
<div class="layout-overlay layout-menu-toggle"></div>
</div>
<!-- / Layout wrapper -->


<script src="../assets/vendor/libs/jquery/jquery.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>


<script>
  $(document).ready(function () {
    var routeName = '<%= route %>';
    var geturl =  routeName=='featured' ?'featuredpropertieslist':'propertieslist'  // Assuming you're passing this variable from EJS
    var buttonname =  routeName=='featured' ?'Remove From Featured':'Add To Featured'  // Assuming you're passing this variable from EJS

    var dataTable = $('#example').DataTable({
      processing: true,
      serverSide: true,
      ajax: {
        url: 'https://www.safehomes.ae/backend/'+geturl, // Replace with your API endpoint
        dataSrc: 'data', // Key that holds the array of data in the API response
        data: function (d) {
          // Add any additional parameters you want to send to the server here
        },
      },
      columns: [
        {data: 'uniqueId'},
        { data: 'plName' },
        { data: 'plPropertyType' },
        { data: 'plPropertySaleRent' },
        { data: 'plCountry' },
        { data: 'plExpeactedPrice' },
        {
          data: null,
          render: function (data, type, row) {
            return `<div class="dropdown">
              <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                <i class="bx bx-dots-vertical-rounded"></i>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item featured-button" href="javascript:void(0);"><i class="bx bx-star me-1"></i>${buttonname} </a>
                <a class="dropdown-item" href="/backend/editproperties?id=${row._id}"><i class="bx bx-edit me-1"></i> Edit /View </a>
                <a class="dropdown-item delete-btn" href="javascript:void(0);"><i class="bx bx-trash me-1"></i> Delete</a>
              </div>
            </div>`;
          },
        },
      ],
    });

    // Delete Button Click Event
    function deleteData(id) {
    $.ajax({
      url: `https://www.safehomes.ae/backend/deleteproperty/${id}`,
      type: 'DELETE',
      success: function (response) {
        dataTable.ajax.reload();
      },
      error: function (error) {
        console.error('Error deleting data:', error);
      },
    });
  }

  function toggleFeatured(id, isFeatured) {
    var formDataObj = { id: id, status: isFeatured ? 'notfeatured' : 'featured' };

    $.ajax({
      url: `https://www.safehomes.ae/backend/addfeatured`,
      type: 'POST',
      data: JSON.stringify(formDataObj),
      contentType: 'application/json',
      success: function (response) {
        dataTable.ajax.reload();
      },
      error: function (error) {
        console.error('Error updating data:', error);
      },
    });
  }

  $('#example').on('click', '.delete-btn', function () {
    var data = dataTable.row($(this).closest('tr')).data();
    var id = data._id;
    deleteData(id);
  });

  $('#example').on('click', '.featured-button', function () {
    var data = dataTable.row($(this).closest('tr')).data();
    var id = data._id;
    
    if (routeName === 'featured') {
      toggleFeatured(id, true); // Remove from Featured
    } else if (routeName === 'properties') {
      toggleFeatured(id, false); // Add to Featured
    }
  });
 });
</script>


                                    
                                        <%- include('./include/end.ejs') -%>